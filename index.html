<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Chart</title>

  <link rel="stylesheet" href="https://uicdn.toast.com/chart/latest/toastui-chart.min.css" />
  <script src="https://uicdn.toast.com/chart/latest/toastui-chart.min.js"></script>
</head>

<body>

  <form id="setDate">
    <label>
      Start
      <input type="date" id="startDate" />
    </label>
    <label>
      End
      <input type="date" id="endDate" />
    </label>
    <button>Submit</button>
  </form>

  <div id="chart-area"></div>


  <script>


    const el = document.getElementById('chart-area');
    const options = {
      series: {
        spline: true,
        eventDetectType: 'grouped',
        zoomable: true,
      },
      chart: {
        title: 'Heater Monitoring',
        width: 1000,
        height: 500
      },
      theme: {
        yAxis: [
          {
            title: {
              fontFamily: 'monaco',
              fontSize: 16,
              fontWeight: 400,
              color: '#000',
            },
            label: {
              fontFamily: 'monaco',
              fontSize: 16,
              fontWeight: 400,
              color: '#000',
            },
          },
          {
            title: {
              fontSize: 16,
              fontWeight: 600,
              color: '#000',
            },
            label: {
              fontFamily: 'monaco',
              fontSize: 16,
              fontWeight: 700,
              color: '#000',
            },
            width: 3,
            color: '#000',
          },
        ],
      },
      xAxis: {
        title: 'Time',
        pointOnColumn: false,
        // margin: 40,
        date: {
          format: 'HH',
          // format: 'DD-MM-YYYY',
        },
      },
      // yAxis: {
      //   title: 'Value',
      // },
      tooltip: {
        formatter: (value) => `${value}Â°C`,
      },
      legend: {
        align: 'top',
      },
    };



    async function fetchMoviesJSON() {
      const response = await fetch('/fetch.php');
      const movies = await response.json();
      return movies;
    }


    var chart = ''
    const setDate = document.getElementById('setDate');
    setDate.addEventListener('submit', fetchNewData);

    fetchMoviesJSON().then(data => {
      chart = toastui.Chart.lineChart({el, data, options});
    });



    async function fetchNewData(event) {
      event.preventDefault();
      const endDate = document.querySelector('#endDate').value;
      const startDate = document.querySelector('#startDate').value;

      const response = await fetch(`/fetch.php?startDate=${startDate}&endDate=${endDate}`);
      const movies = await response.json();
      console.log(movies)
      chart.setData(movies)

    }

  // const data = {
  //   categories: ['01/01/2020','02/01/2020','03/01/2020','04/01/2020','05/01/2020','06/01/2020','07/01/2020','08/01/2020','09/01/2020','10/01/2020','11/01/2020','12/01/2020',],
  //   series: [{
  //       name: 'Seoul',
  //       data: [-3.5, -1.1, 4.0, 11.3, 17.5, 21.5, 25.9, 27.2, 24.4, 13.9, 6.6, -0.6],
  //     },
  //     {
  //       name: 'Seattle',
  //       data: [3.8, 5.6, 7.0, 9.1, 12.4, 15.3, 17.5, 17.8, 15.0, 10.6, 6.6, 3.7],
  //     },
  //     {
  //       name: 'Sydney',
  //       data: [22.1, 22.0, 20.9, 18.3, 15.2, 12.8, 11.8, 13.0, 15.2, 17.6, 19.4, 21.2],
  //     },
  //     {
  //       name: 'Moscow',
  //       data: [-10.3, -9.1, -4.1, 4.4, 12.2, 16.3, 18.5, 16.7, 10.9, 4.2, -2.0, -7.5],
  //     },
  //     {
  //       name: 'Jungfrau',
  //       data: [-13.2, -13.7, -13.1, -10.3, -6.1, -3.2, 0.0, -0.1, -1.8, -4.5, -9.0, -10.9],
  //     },
  //   ],
  // };
  // console.log(data)
  </script>
</body>

</html>